{% extends "base.html" %}

{% block title %}Сотрудники — ИС ОЭРСК{% endblock %}

{% block content %}

<h1>Сотрудники компании АО «НИИ ТП»</h1>
<p class="lead">
    Список всех активных сотрудников, участвующих в системе оценки эффективности.
</p>

<div class="section">
    <form method="GET" action="{{ url_for('views.employees') }}" class="filter-form">
        <label for="department_filter">Фильтр по подразделению:</label>
        <select name="department" id="department_filter" onchange="this.form.submit()">
            <option value="">Все подразделения</option>
            {% for dept in departments %}
            <option value="{{ dept.id }}" {% if selected_dept == dept.id %}selected{% endif %}>
                {{ dept.name }}
            </option>
            {% endfor %}
        </select>
    </form>
</div>

{% if employees %}
    <div class="section">
        <h2>Список сотрудников</h2>
        <table>
            <thead>
                <tr>
                    <th>ФИО</th>
                    <th>Должность</th>
                    <th>Подразделение</th>
                    <th>Роль в системе</th>
                    <th>Дата приёма</th>
                    <th>Фото</th>
                </tr>
            </thead>
            <tbody>
                {% for emp in employees %}
                <tr>
                    <td>{{ emp.full_name }}</td>
                    <td>{{ emp.position.title if emp.position else '–' }}</td>
                    <td>{{ emp.department.name if emp.department else '–' }}</td>
                    <td>
                        <span class="badge {% if emp.role.name == 'admin' %}badge-admin
                               {% elif emp.role.name == 'manager' %}badge-manager
                               {% else %}badge-employee{% endif %}">
                            {{ {
                                'admin': 'Администратор',
                                'manager': 'Менеджер',
                                'employee': 'Сотрудник'
                            }[emp.role.name] }}
                        </span>
                    </td>
                    <td>{{ emp.hire_date.strftime('%d.%m.%Y') if emp.hire_date else '–' }}</td>
                    <td>
                        {% if emp.photo %}
                            <img src="{{ url_for('static', filename=emp.photo) }}" 
                                alt="Фото" 
                                style="width: 50px; height: 50px; border-radius: 50%; object-fit: cover;">
                        {% else %}
                            <img src="{{ url_for('static', filename='img/avatar.png') }}" 
                                alt="Фото" 
                                style="width: 50px; height: 50px; border-radius: 50%; object-fit: cover;">
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
{% else %}
    <div class="alert alert-info">
        Сотрудники не найдены.
    </div>
{% endif %}

<div class="action-buttons">
    <a href="{{ url_for('views.index') }}" class="btn btn-outline">На главную</a>
</div>

{% endblock %}