<!-- templates/export_import.html -->
{% extends "base.html" %}

{% block title %}Импорт и экспорт данных — ИС ОЭРСК{% endblock %}

{% block content %}

<div class="page-header">
    <h1>Импорт и экспорт данных</h1>
    <p class="lead">Загрузите данные из файла или сформируйте отчёт в PDF.</p>
</div>

<div class="section card">
    <h2 class="card-title">Импорт данных из CSV/XLSX</h2>
    <p class="card-desc">Загрузите файл с оценками сотрудников. Поддерживаемые форматы: <code>.csv</code>, <code>.xlsx</code></p>
    <form method="POST" action="{{ url_for('views.import_data') }}" enctype="multipart/form-data">
        <div class="form-group">
            <label for="file">Выберите файл</label>
            <input type="file" id="file" name="file" accept=".csv,.xlsx" required>
        </div>
        <button type="submit" class="btn btn-primary">Загрузить файл</button>
    </form>
</div>

<div class="section card">
    <h2 class="card-title">Экспорт в PDF</h2>
    <p class="card-desc">Сформируйте отчёт по сотрудникам.</p>
    <form method="POST" action="{{ url_for('views.export_pdf') }}">
        <div class="form-group">
            <label for="report_type">Тип отчёта</label>
            <select id="report_type" name="report_type" required>
                <option value="all">Все сотрудники</option>
                <option value="above_avg">С оценкой выше средней</option>
                <option value="below_avg">С оценкой ниже средней</option>
                <option value="by_department">По подразделениям</option>
            </select>
        </div>
        <div class="form-group" id="dept-select" style="display: none;">
            <label for="department_id">Подразделение</label>
            <select id="department_id" name="department_id">
                {% for dept in departments %}
                <option value="{{ dept.id }}">{{ dept.name }}</option>
                {% endfor %}
            </select>
        </div>
        <button type="submit" class="btn btn-primary">Сформировать PDF</button>
    </form>
</div>

<div class="action-buttons">
    <a href="{{ url_for('views.dashboard') }}" class="btn btn-outline">Назад в кабинет</a>
</div>

{% endblock %}

{% block scripts %}
<script>
document.querySelector('select[name="report_type"]').addEventListener('change', function () {
    const deptSelect = document.getElementById('dept-select');
    deptSelect.style.display = this.value === 'by_department' ? 'block' : 'none';
});
</script>
{% endblock %}